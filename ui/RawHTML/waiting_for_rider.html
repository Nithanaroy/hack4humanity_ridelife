<html>

<head>
    <link href="bootstrap-3.2.0-dist/css/bootstrap.min.css" type="text/css" rel="stylesheet" />

    <script src="jquery-2.1.1.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.1.0.js"></script>

    <script type="text/javascript">
    $(function() {

        var assigned_driver = null;
        var mongoUrl = 'http://10.143.179.16:3000/';
        var socket = io(mongoUrl);

        // Driver is assigned, show a screen displayng the driver details
        socket.on('assigned_driver', function(driver) {
            assigned_driver = JSON.parse(driver);
            console.log(assigned_driver);
            $("#driver_name").text(assigned_driver.name);
            $("#driver_license").text(assigned_driver.license);
            $("#driver_phone").text(assigned_driver.phone_no);
            $("#stage2").removeClass('hidden');
            $("#stage1").addClass('hidden');
        });

        // Exchange the tokens

        $("#finish_ride").click(function() {
            if (assigned_driver) {

                // make an ajax call completing the ride
                $.ajax({
                    url: mongoUrl + 'users/completeride',
                    type: "GET",
                    data: {
                        drunker_id: 832546325472,
                        driver_id: assigned_driver.asu_id
                    },
                    crossDomain: true,
                    success: function(data) {
                    	window.location.href = 'thankyou_drunker.html';
                    },
                    error: function(data) {
                        console.log(data);
                    },
                    complete: function() {}
                });

                assigned_driver = null;
            };
        })

    });


    function goBack() {
        window.location = "give_take_ride.html"
    }
    </script>
</head>

<body>
    <div class='container'>
        <div id='stage1'>
            <!-- The waiting screen when page loads -->

            <h1 align="center">Request Processing...</h1>

            <img class="media-object" src="requestprocess.jpg" height='200' width='200' />

            <a href="give_take_ride.html">
                <button class="btn btn-default btn-lg" onClick="goBack()">Back</button>
            </a>
        </div>

        <div id='stage2' class='hidden'>
            <!-- Showing the detials of the driver assigned -->

            <h1 align="center">Your ride on its way...</h1>

            <p>
                <strong id='driver_name'></strong> has agreed to give you a ride whose license no. is
                <strong id='driver_license'></strong>and will be with you in approximately 10 minutes. You can reach him / her at
                <strong id='driver_phone'></strong>
            </p>

            <!-- Clicking this button exchange the tokens -->
            <button id='finish_ride' class='btn btn-success'>Finish Ride</button>
        </div>
    </div>
</body>

</html>
